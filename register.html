<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register</title>
    <link rel="stylesheet" href="./assets/css/output.css">
</head>
<body>
    <!-- Registration Section -->
    <section class="py-24 md:py-0 lg:py-0 xl:py-0 bg-gray-50 dark:bg-gray-900">
        <div class="flex flex-col items-center justify-center px-6 py-8 mx-auto md:h-screen lg:py-0">
            <div class="w-full bg-white rounded-lg shadow dark:border md:mt-0 sm:max-w-md xl:p-0 dark:bg-gray-800 dark:border-gray-700">
                <div class="p-6 space-y-4 md:space-y-6 sm:p-8">

                    <!-- Page title -->
                    <h1 class="text-xl font-bold leading-tight tracking-tight text-gray-900 md:text-2xl dark:text-white">
                        Create new Account
                    </h1>

                    <!-- Registration form -->
                    <form class="space-y-4 md:space-y-6" action="#">

                        <!-- Email input -->
                        <div>
                            <label for="email" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Your email</label>
                            <input type="email" name="email" id="email" class="bg-gray-50 border border-gray-300 text-gray-900 rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" placeholder="name@example.com" required="">
                        </div>

                        <!-- Password input -->
                        <div>
                            <label for="password1" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Password</label>
                            <input type="password" name="password1" id="password1" placeholder="••••••••" class="bg-gray-50 border border-gray-300 text-gray-900 rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" required="">
                        </div>

                        <!-- Repeat password input -->
                        <div>
                            <label for="password2" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Repeat Password</label>
                            <input type="password" name="password2" id="password2" placeholder="••••••••" class="bg-gray-50 border border-gray-300 text-gray-900 rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" required="">
                        </div>

                        <div class="flex items-center justify-between">
                            <a href="#" class="text-sm font-medium text-primary-600 hover:underline dark:text-white">Forgot password?</a>
                        </div>

                        <!-- Register button -->
                        <button type="submit" class="w-full text-white border border-white bg-primary-600 hover:bg-gray-700 focus:ring-4 focus:outline-none focus:ring-primary-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-primary-600 dark:hover:bg-primary-700 dark:focus:ring-primary-800">Register</button>

                        <p class="text-sm font-light text-gray-500 dark:text-gray-400">
                            Have an account? <a href="login.html" class="font-medium text-primary-600 hover:underline dark:text-white">Sign in</a>
                        </p>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <script>
        // Get form element
        const form = document.querySelector('form')

        // Check if user is already logged in
        let auth_json = localStorage.getItem('auth')
        const auth = auth_json !== null ? JSON.parse(auth_json) : false

        if(auth.is_loggedIn) {
            // Redirect to dashboard if already logged in
            window.location.href = "http://127.0.0.1:5500/dashboard.html"
        }

        // Retrieve existing users from localStorage
        let users_json = localStorage.getItem('users')
        let users = users_json !== null ? JSON.parse(users_json) : []

        form.addEventListener('submit', event => {
            event.preventDefault()

            const elements = event.target.elements
            const email = elements[0].value
            const password1 = elements['password1'].value
            const password2 = elements['password2'].value

            // Check if passwords match
            if(password1 !== password2) {
                alert("Passwords are not the same!")
                return
            }

            // Check if email already exists
            const exists = users.some(u => u.email === email)
            if(exists) {
                alert("This email was used before!")
                return
            }

            // Create new user object
            const user = {
                email,
                password: password1
            }

            // Add user to users array and save in localStorage
            users.push(user)
            localStorage.setItem('users', JSON.stringify(users))

            // Save current user in localStorage
            localStorage.setItem('currentUser', JSON.stringify(user))

            // Set auth status
            const auth = {
                is_loggedIn: true,
                email: email
            }
            localStorage.setItem('auth', JSON.stringify(auth))

            // Notify user and redirect to dashboard
            alert("Registration succeeded!")
            window.location.href = "http://127.0.0.1:5500/dashboard.html"
        })
    </script>
</body>
</html>